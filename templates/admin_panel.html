<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel - QuickBite</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style2.css') }}"
    />
    <link
      rel="icon"
      href="{{ url_for('static', filename='QuickBite-Logo.png') }}"
    />
  </head>

  <body>
    <header class="hero">
      {% if session.get('admin_user') and session['admin_user'].get('logo') %}
      <img
        src="{{ url_for('static', filename='logos/' ~ session['admin_user']['logo']) }}"
        alt="Admin Logo"
        class="logo"
      />
      {% else %}
      <img
        src="{{ url_for('static', filename='QuickBite-Logo.png') }}"
        alt="QuickBite Logo"
        class="logo"
      />
      {% endif %} {% if session.get('admin_user') %}
      <h1>{{ session['admin_user']['business'] }}</h1>
      <p>Category: {{ session['admin_user']['category'] }}</p>
      {% else %}
      <h1>Welcome, Admin</h1>
      {% endif %}

      <div class="logout-container">
        <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
      </div>
    </header>

    <main class="container">
      {% with messages = get_flashed_messages() %} {% if messages %}
      <div class="alert success">{{ messages[0] }}</div>
      {% endif %} {% endwith %}

      <section class="admin-summary">
        <div class="summary-card">
          <h2>Total Orders</h2>
          <p>{{ total_orders }}</p>
        </div>
        <div class="summary-card">
          <h2>Total Revenue</h2>
          <p>₹{{ total_revenue }}</p>
        </div>
      </section>

      <section class="add-item-form">
        <h2>Add New Menu Item</h2>
        <form
          action="{{ url_for('add_item') }}"
          method="POST"
          enctype="multipart/form-data"
        >
          <label for="name">Item Name</label>
          <input type="text" id="name" name="name" required />

          <label for="price">Price (₹)</label>
          <input type="number" id="price" name="price" required />

          <label for="image_file">Upload Image</label>
          <input
            type="file"
            id="image_file"
            name="image_file"
            accept="image/*"
            required
          />

          <label for="category">Category</label>
          <input type="text" id="category" name="category" required />

          <button type="submit" class="primary-btn">Add Item</button>
        </form>
      </section>

      <section class="admin-menu-list">
        <h2>Current Menu</h2>

        <form
          class="search-bar"
          method="get"
          action="{{ url_for('admin_panel') }}"
        >
          <input
            type="text"
            name="search"
            placeholder="Search by name or category"
            value="{{ search_query or '' }}"
          />
          <button type="submit">Search</button>
        </form>

        {% if menu %}
        <div class="menu-grid">
          {% for item in menu %}
          <div class="menu-card">
            <img
              src="{{ url_for('static', filename='uploads/' ~ item.image) }}"
              alt="{{ item.name }}"
              onerror="this.onerror=null;this.src='{{ url_for('static', filename='default.png') }}';"
            />
            <h3>{{ item.name }}</h3>
            <p>₹{{ item.price }}</p>
            <p class="category">{{ item.category }}</p>

            <div class="menu-actions">
              <a
                href="{{ url_for('edit_item', item_id=item.id) }}"
                class="btn btn-warning btn-sm"
                >Edit</a
              >
              <a
                href="{{ url_for('delete_item', item_id=item.id) }}"
                class="btn btn-danger btn-sm"
                onclick="return confirm('Are you sure you want to delete this item?');"
                >Delete</a
              >
            </div>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <p class="no-items">No items found.</p>
        {% endif %}
      </section>
    </main>

    <footer>&copy; 2025 QuickBite. All rights reserved.</footer>
  </body>
</html>
